<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DK App Tutorial</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DK App Tutorial</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This is a detailed tutorial for making a full stack app using Python for the backend and react for the front end.  This tutorial will cover nearly every part of the process nearly line by line at the end of which you should have a fully functional app and a solid understanding of the basics of a full stack development process.</p>
<p>Disclaimer: I am learning most of these skills as I write this tutorial.  Please give any <a href="Introduction.html#Feedback">feed back</a> to help me fix mistakes.</p>
<p>I was inspired to make this as when I was trying to learn these skill I had to keep jumping back and forth between and bunch of different tutorials that all covered small parts of the process and then had to fill in the gaps myself.  I wanted to make a tutorial that covered <em>everything</em> so that it could be used as a all in one resource (at least if you are using this stack)</p>
<h1 id="covered-topics"><a class="header" href="#covered-topics">Covered Topics</a></h1>
<p>As this tutorial shows nearly every step of creating a full web based api and app there are many tools involved.  This is a list of most of the tools that will be used.  There is no guarantee that the tutorial will cover them in detail, but it will explain how to use them in service of this project.</p>
<ul>
<li>Git</li>
<li>VScode</li>
<li>Python</li>
<li>FastAPI</li>
<li>SQLite</li>
<li>SQLalchamy</li>
<li>Pytest</li>
<li>Numpy docs/sphinx</li>
<li>UV</li>
<li>uvicorn</li>
<li>Docker</li>
<li>React</li>
<li>Next</li>
<li>More?</li>
</ul>
<h1 id="app-overview"><a class="header" href="#app-overview">App Overview</a></h1>
<p>The app that this tutorial will show is DK app, DK is my and my partners initials.  I wanted to make an app that we could use as a synced grocery list, and started adding features like todo lists, recipes, budgets and more.</p>
<p>The app has to main parts.  The backend is a python server using fastapi running on a uvicorn serving in a docker image.  This will take web requests to save or request data.  The frontend will be a website in react and hopefully an app in react native that can be used to access the grocery list, todo list etc...</p>
<p>The complete app can be found here: LINK</p>
<h1 id="tutorial-overview"><a class="header" href="#tutorial-overview">Tutorial Overview</a></h1>
<p>These are the main chapters of the tutorial:</p>
<ul>
<li>Introduction
<ul>
<li>(what your reading now)</li>
</ul>
</li>
<li>Setup and installation
<ul>
<li>This will cover installing and setting up VSCode, git, and more.</li>
<li>Configuring VSCode and git, and creating the initial project directory</li>
</ul>
</li>
<li>Server
<ul>
<li>This will cover making the fastapi server along with the database</li>
</ul>
</li>
<li>Web App
<ul>
<li>This will cover making the website version of the app</li>
</ul>
</li>
<li>Native App
<ul>
<li>This will cover making the mobile app version</li>
</ul>
</li>
<li>Appendix
<ul>
<li>This is a collection of various extra resources</li>
</ul>
</li>
</ul>
<h1 id="feedback"><a class="header" href="#feedback">Feedback</a></h1>
<p>As I said I am not an expert at these tools, this is just me documenting each step I took to make DK app in a tutorial format.  If there are any mistakes, questions, and anything else you want to add you can send an email here:</p>
<p>EMAIL</p>
<h1 id="license"><a class="header" href="#license">License</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vs-code-setup"><a class="header" href="#vs-code-setup">VS Code Setup</a></h1>
<p>VS Code is our IDE of choice for this project.  It is pretty lightweight and can be configured with plugins to work with nearly any project or programing language.</p>
<h3 id="install"><a class="header" href="#install">Install</a></h3>
<p>VS Code can be found here:<br />
https://code.visualstudio.com/docs/setup/setup-overview</p>
<p>It is available for Windows, Linux, and Mac.</p>
<h3 id="setup"><a class="header" href="#setup">Setup</a></h3>
<h4 id="config"><a class="header" href="#config">Config</a></h4>
<p>VS Code's setting can be configured through its UI or by editing the json file.  I have preferred to use the json file as it is easier to copy paste multiple settings.  You should be able to use the search bar of the setting's UI to change each of the settings in the UI if you decided not to go with the json file.</p>
<p>VS Code has different layers of settings.  It has global or profile settings that apply to the whole editor, or profile and folder settings that can overwrite the global settings in a specific directory.</p>
<p>Note that the <code>settings.json</code> file should be a pair of <code>{}</code> and each setting should be separated by commas.</p>
<p>Hovering over a setting in the json file should have VS Code pull up a short description of the setting.</p>
<p>These are some of the main settings that I set for my editor:</p>
<pre><code>// Workbench settings
"workbench.settings.editor": "json",
"workbench.tree.indent": 16,
"workbench.colorTheme": "Default High Contrast",
</code></pre>
<ul>
<li>
<p><code>editor</code> is how you choose if you want the settings button to open the UI or the json file.</p>
</li>
<li>
<p><code>indent</code> is how many pixels you want indentions to be in the file explorer.</p>
</li>
<li>
<p><code>colorTeme</code> is the theme for VS Code a list of which can be found <a href="https://vscodethemes.com/">here</a></p>
</li>
</ul>
<pre><code>// Explorer Settings
"explorer.autoReveal": true,
"explorer.confirmDragAndDrop": false,
</code></pre>
<ul>
<li>
<p><code>autoReveal</code> will cause the file explorer to expand directories and highlight the file you are actively working on.  Some preferer to turn this off and use something like <a href="https://marketplace.visualstudio.com/items?itemName=SmarterTomato.locate-this-document">locate this document</a> instead.</p>
</li>
<li>
<p><code>confirmDragAndDrop</code> will ask for confirmation any time you drag and drop files, moving them around the project directory.</p>
</li>
</ul>
<pre><code>// Editor setings
"files.autoSave": "onFocusChange",
"editor.insertSpaces": false,
"editor.cursorStyle": "block",
</code></pre>
<ul>
<li><code>autoSave</code> in this mode files will be saved as soon as you click off of them.  This can sometimes be annoying though when combined with formatting on save, but I prefer it over trying to figure out why my changes are not working only to find out I haven't saved changes to three of the files I was editing ten minutes ago.</li>
<li><code>insertSpaces</code> with this false tab will do what it is supposed to do and insert a tab.  I use keyboard to navigate to cursor pretty often while working and use shift + arrow keys to select text and I hate having to click through each of the spaces that get added in for indentions and much prefer tabs.</li>
<li><code>cursorStyle</code> is just choosing a character width block like command lines often have, or a bar the sits between characters like most modern applications.</li>
</ul>
<p>There is plenty of other settings to explore if you want to further customize.  I will cover the setting some more when I am explaining setting up the folder level setting for the different parts of the project.</p>
<p>Appendix <a href="SetupAndInstall/./../Appendix/VS%20Code%20Configs.html">VS Code Configs</a></p>
<h4 id="extensions"><a class="header" href="#extensions">Extensions</a></h4>
<p>This is a list of general extensions that I recommend for VS Code.  Most extensions have their own settings that can be added to your global or folder settings files.</p>
<h5 id="general"><a class="header" href="#general">General</a></h5>
<p><em><strong>Rainbow CSB:</strong></em></p>
<p><code>mechatroner.rainbow-csv</code></p>
<p>This one has many features for editing and searching csv (comma separated values) files.  The main feature is that it colors the text of different  columns of the cvs the same colors to better see what each of the values in a row match to each of the.  It also has tools for SQL like queries on the csv files and and more.</p>
<p><img src="SetupAndInstall/./../Resources/rainbowcsv.png" alt="image" /></p>
<p><em><strong>Better Comments</strong></em></p>
<p><code>aaron-bond.better-comments</code></p>
<p>This adds a few options to mark code comments as specific types of messages.</p>
<p><img src="SetupAndInstall/./../Resources/bettercomments.png" alt="image" /></p>
<p><em><strong>Todo Tree</strong></em></p>
<p><code>Gruntfuggly.todo-tree</code></p>
<p>This highlights comments that start with TODO</p>
<pre><code># TODO Fix
// TODO Fix
</code></pre>
<p>and creates a file directory like tree of them that can be accessed on the side bar.  This is useful to mark function templates that need to be implemented, or debugging code to be removed.</p>
<p>For the debug marker, <code>DEBUG</code> would need to be added to the settings file:</p>
<pre><code>"todo-tree.general.tags": [
	"BUG",
	"HACK",
	"FIXME",
	"TODO",
	"XXX",
	"DEBUG",
	"[ ]",
	"[x]"
],
</code></pre>
<p>There are plenty of other settings for it and you add or change the tags to what ever you prefer.</p>
<p><em><strong>VsCode Action Buttons</strong></em></p>
<p><code>seunlanlege.action-buttons</code></p>
<p>This allows you to add customized buttons to the bottom of the workspace used to quickly run commands.  This is useful when commands to build, run, debug or other tasks require longer commands and you want a quick way to repeat those commands.</p>
<p>This is an example of a button to run pytest with options:</p>
<pre><code>// Action Buttons
"actionButtons": {
	"commands": [
		{
			"name": "pytest",
			"color": "yellow",
			"command": "uv run pytest -v -rP"
		}
	],
	"defaultColor": "white",
	"reloadButton": "↻",
	"loadNpmCommands": false
},
</code></pre>
<p><em><strong>Error Lens</strong></em></p>
<p><code>usernamehw.errorlens</code></p>
<p>This just adds more aggressive highlighting of errors with plenty of settings to customize it.</p>
<p><em><strong>Even Better TOML</strong></em></p>
<p><code>tamasfe.even-better-toml</code></p>
<p>This adds formatting and checking of toml files, which will be useful for this project.</p>
<p><em><strong>Dependi</strong></em></p>
<p><code>fill-labs.dependi</code></p>
<p>This can check dependencies for a few different languages like Go, Rust, Python, others.  This will help make sure the the dependencies we are using are up-to-date or don't have known vulnerabilities.</p>
<p>A full list of extensions I use can be found in ![image](./../Resources/VS Code Extensions)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="git"><a class="header" href="#git">Git</a></h1>
<p>Git is a version control tool that is very common for most projects.  In it most simple form it is used to create a set of save states of the project so that if a change cause major unrecoverable issues you can roll your project back to an older version you know works.</p>
<p>It can also be used with platforms like GitHub to store your projects in the cloud and coordinate changes between multiple computers or team members.</p>
<p>Another common use relevant to us is to create branches where you can work on implementing a new feature or explore experimental ideas saving those changes to a different branch with out affecting the main known functional version.</p>
<h3 id="install-1"><a class="header" href="#install-1">Install</a></h3>
<p>Git can be found here:
https://git-scm.com/</p>
<h3 id="setup-1"><a class="header" href="#setup-1">Setup</a></h3>
<p>Most of the setup will be covered in creating the project structure.</p>
<p>Git's basic parts though are made up of a <code>.git</code> directory that is managed by git, and <code>.gitignore</code> files that list files to not include in the version management.</p>
<h4 id="config-1"><a class="header" href="#config-1">Config</a></h4>
<p>Git can be configured through the command line.  The most common config that you will likely have to change is your name, and email.</p>
<pre><code>git config --global user.name "&lt;NAME&gt;"
git config --global user.email "&lt;EMAIL&gt;"
</code></pre>
<p>These will be used to record who created the changes for the commit (project save), and the email will be used to match accounts if you are pushing you project to a remote platform like GitHub.</p>
<p>Quick reference of common git commands: <a href="SetupAndInstall/./../Appendix/Git%20Cheat%20Sheet.html">Git Cheat Sheet</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h1>
<p>Now that we have some of our general tools installed we can begin setting up the projects main directory, set up git, and make our first commit.</p>
<h3 id="making-the-project-directory"><a class="header" href="#making-the-project-directory">Making the Project Directory</a></h3>
<p>There are two ways to make the initial folder.</p>
<ul>
<li>Create a folder on your computer and use git init</li>
<li>Create a project on GitHub, or platform or choice, and clone the repository.</li>
</ul>
<p>I will be doing the second, but the first will work fine, you just skip any steps pertaining to GitHub.</p>
<h4 id="create-the-github-project"><a class="header" href="#create-the-github-project">Create the GitHub Project</a></h4>
<ul>
<li>Create the name for your project.  Mine will be <code>DK_App</code> so any time I use <code>DK_App</code> you will likely need to use your own projects name.</li>
<li>Add a description</li>
<li>Set Public or Private</li>
<li>Add the README</li>
<li>Add the license.   I am using the "AGPL-3.0 license" and if you are directly following this tutorial to copy its code you will also need to include this license in you project.</li>
<li>Create</li>
</ul>
<h4 id="clone-the-github-project"><a class="header" href="#clone-the-github-project">Clone the GitHub Project</a></h4>
<p>I will be using ssh for communication with GitHub.  A tutorial for setting that up for windows can be found <a href="https://www.theserverside.com/blog/Coffee-Talk-Java-News-Stories-and-Opinions/GitHub-SSH-Windows-Example">here</a>.</p>
<p>Once you have you ssh key set up you can clone the project.</p>
<p>With git install for windows I can right click where I would like the project file to live and pick "Open Git Bash here"</p>
<p>Copy the ssh url from GitHub by clicking the green "clone" button and picking ssh.</p>
<p>then in the git bash shell run:</p>
<pre><code>git clone &lt;PASTE URL&gt;
</code></pre>
<p>for window crtl+v and crtl+shift+v both did not work and I had to right click paste the url.</p>
<p>It will then ask you to add GitHub's fingerprint to your list of known hosts.</p>
<p>If you are not using a platform like GitHub instead create a folder with the name of your project then:</p>
<ul>
<li>run <code>git init</code> from the git bash shell in that folder</li>
<li>add an empty README.md file</li>
<li>add the license file</li>
</ul>
<h3 id="open-in-vs-code"><a class="header" href="#open-in-vs-code">Open in VS Code</a></h3>
<p>You can right click the folder and select "Open with VS Code" or open VS Code and use "Open Folder as Project"</p>
<p>Now you can use VS Code to edit the README file and add a description of the project.  This is where you can eventually add the instructions to install and setup, and various links to documentation, tutorials, or socials.  This file uses <a href="https://www.markdownguide.org/">markdown</a> for its formatting</p>
<p>We also want to add a <code>.gitignore</code> file.  This is what we will use to exclude files from being tracked by git.  This is to ignore files the builds, caches, or files holding sensitive data like private keys.</p>
<p>We also need to make the workspace folder for the next part of the project, the python server.  I called this folder <code>dk_server_ws</code></p>
<p>We also make a <code>.vscode</code> directory, that we can put settings and extension files in.  Any setting you add here will be applied to all projects in this git repository.  I am not going to add any here and will be adding settings based on the individual projects.</p>
<p>We will make an <code>extensions.json</code> file in the <code>.vscode</code> directory.  This is where we can list VSCode extension that this project uses.  This is the list of recommendations I had in the setup.</p>
<pre><code>{
	"recommendations": [
		"mechatroner.rainbow-csv",
		"aaron-bond.better-comments",
		"Gruntfuggly.todo-tree",
		"seunlanlege.action-buttons",
		"usernamehw.errorlens",
		"tamasfe.even-better-toml",
		"fill-labs.dependi",
	]
}
</code></pre>
<p>Now when you or anyone cloning your project should see these extensions in their recommendations in VS Code.</p>
<h3 id="workspaces"><a class="header" href="#workspaces">Workspaces</a></h3>
<p>Workspaces allow you effectively open multiple vs code projects at the same time under a single VSCode explorer.  The workspace folders do not have to be in the same parent folder, but in this case they will be.  More details on workspaces <a href="https://code.visualstudio.com/docs/editor/workspaces/workspaces">link</a>.</p>
<p>We can add a workspace for the server project by right clicking in the explorer and choosing "add folder to workspace" then picking the <code>dk_server_ws</code> directory.</p>
<p>We then want to save the workspace to a file in the main projects directory using "save workspace as" in the "file" menu.  When we reopen VSCode to work on the project we will want to use "open workspace from file" and open this file.</p>
<p>You can modify the workspace save file to customize it.</p>
<p>I added names to the different workspaces, this is also where you put your workspace level settings.</p>
<pre><code>{
	"folders": [
		{
			"name": "ROOT",
			"path": "."
		},
		{
			"name": "API_Server",
			"path": "dk_server_ws"
		}
	],
	"settings": {}
}
</code></pre>
<h3 id="directory-overview"><a class="header" href="#directory-overview">Directory Overview</a></h3>
<pre><code>DK_App
|_ .vscode
|  |_ extensions.json
|  |_ settings.json
|_ dk_server_ws
|_ .gitignore
|_ DK_App.code-workspace
|_ LICENSE
|_ README.md
</code></pre>
<p>Appendix <a href="SetupAndInstall/./../Appendix/Project%20Directory%20Structure.html">Project Directory Structure</a></p>
<h3 id="commit-and-push"><a class="header" href="#commit-and-push">Commit and push</a></h3>
<p>Now we can create a commit (project version save) and push it to our remote repository.</p>
<p><img src="SetupAndInstall/./../Resources/gitui.png" alt="image" /></p>
<p>I will mostly use the UI for this (for now at least).</p>
<ul>
<li>Click source control on the left.</li>
<li>Add a message for the commit that describes the changes:
<ul>
<li>"Updated the readme, and created the workspace for the folder"</li>
</ul>
</li>
<li>Hit "commit", it will then ask if you want to stage the changes, you do.</li>
<li>If it has an error about name and email you need to use git config <a href="SetupAndInstall/./../Appendix/Git%20Ignores.html">Git Trouble Shoot</a>.</li>
<li>Then you can hit "sync" to push to GitHub.</li>
</ul>
<p>We now have our initial parent project set up and can move to starting on the server project.</p>
<h4 id="extra-command-line-git"><a class="header" href="#extra-command-line-git">Extra: Command Line git</a></h4>
<pre><code>git add .

git commit -m "Updated the readme, and created the workspace for the folder"

git push
</code></pre>
<p>This is the equivalent command for the UI process. <a href="SetupAndInstall/./../Appendix/Git%20Cheat%20Sheet.html">Git Cheat Sheet</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="uv"><a class="header" href="#uv">UV</a></h1>
<p>UV is going to be our python package/version manager of choice.</p>
<p><a href="https://astral.sh/blog/uv">UV Website</a></p>
<p>This is where you can download UV, and learn more about it.  UV lets your create a isolated version of python for our project and can add and remove dependences for us and manage tools like pytest.  There is not to much more to say about it, but now with this we can begin setting of the server side of the project.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h1>
<p>The first part of the project that we will be working on is creating the backed which will be a python FastAPI server that uses a SQLite database to save data.</p>
<h3 id="fastapi"><a class="header" href="#fastapi">FastAPI</a></h3>
<p>FastAPI is how our mobile app and website will communicate with the server to request and submit data.  FastAPI works through http requests where the arguments of the request are encoded into the URL.</p>
<p>Example:</p>
<pre><code>POST dkapp.com/grocery/item/1/"Soup"/2
</code></pre>
<p>POST, grocery, and item define the path for the function being called, and 1, "Soup", and 2 are augments passed to the function.</p>
<h3 id="plan"><a class="header" href="#plan">Plan</a></h3>
<p>Here is an overview of how this project will go.</p>
<ul>
<li>We start a new git branch for development of the server.</li>
<li>Use UV to create the python environment.</li>
<li>Add VSCode extensions, add dependences for Pytest, and Numpy docs.</li>
<li>Make a "Hello World" server.</li>
<li>Set up Docker and configure the project to hot reload in it.</li>
<li>Design and setup the database.</li>
<li>Then add features, add tests, add docs, commit for:
<ul>
<li>CRUD on the database.</li>
<li>Routes</li>
<li>Authentications</li>
<li>etc.</li>
</ul>
</li>
</ul>
<p>Lets get started.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-project-setup"><a class="header" href="#server-project-setup">Server Project Setup</a></h1>
<p>The first thing that we want to do to get started is to create a branch on our git repository.</p>
<p><img src="Server/../Resources/gitbranchui.png" alt="image" /></p>
<p>Using the UI, we can create a branch off of the main branch and publish it.  Looking at your remote repository you should now be able to see the new branch.</p>
<p>Now any changes we make will not affect the main branch, and we can make sure that all of the features are working and bug free before merging back into main.</p>
<h3 id="create-the-uv-project"><a class="header" href="#create-the-uv-project">Create the UV project</a></h3>
<p>Next we need to run <code>uv init --package</code> in the directory of the server.  By running it in the directory of the server, it will name the package the same as the directory's name.  If you want to specify a name, then run:</p>
<p><code>uv init --package dk-server</code></p>
<p>Replacing the name with your own projects name.</p>
<p>This will create a src directory, and a pyproject.toml.  The pyproject file is used by uv and build tools to manage dependences and configure the running of tools like pytest.</p>
<p>We also need to add a <code>.vscode</code> directory and add a <code>settings.json</code> and <code>extensions.json</code> files to it.</p>
<p>Other files and directories to add:</p>
<ul>
<li>Directories
<ul>
<li>database (in dk-server)</li>
<li>docs (in dk-server)</li>
<li>devscripts (in src)</li>
<li>tests (in dk-server)</li>
<li>scripts (in workspace)</li>
</ul>
</li>
<li>Files
<ul>
<li>Dockerfile (in workspace)</li>
<li>.gitignore (in workspace)</li>
<li>.dockerignore (in workspace)</li>
<li>ruff.toml (in workspace)</li>
<li>main.py (in dk_server)</li>
</ul>
</li>
</ul>
<p>Shown below:</p>
<pre><code>dk_server_ws
|- .vscode
|- dk-server
|  |- databases
|  |- docs
|  |- src
|  |  |- devscripts
|  |  |- dk_server
|  |  |  |- __init__.py
|  |  |  |- main.py
|  |- tests
|  |- .python-version
|  |- pyproject.toml
|  |- README.md
|- scripts
|- .dockerignore
|- .gitignore
|- Dockerfile
|- ruff.toml
</code></pre>
<h3 id="configuration"><a class="header" href="#configuration">Configuration</a></h3>
<p>Next we need to start filling out some of these files for configuring the project.</p>
<h4 id="settingsjson"><a class="header" href="#settingsjson">settings.json</a></h4>
<pre><code>{
	// Python settings
	"python.analysis.autoSearchPaths": true,
	"python.analysis.diagnosticSeverityOverrides": {
		"reportMissingImports": "none"
	},
	"python.analysis.extraPaths": [
		"${workspaceFolder}/dk-server/src"
	],
	"python.envFile": "${workspaceFolder}/dk-server/.env",
	"python.terminal.activateEnvironment": true,
	"python.defaultInterpreterPath": "${workspaceFolder}/dk-server/.venv/Scripts/python",
	// Test settings
	"python.testing.pytestEnabled": true,
	"python.testing.unittestEnabled": false,
	"python.testing.cwd": "${worksapceFolder}/dk-server/tests",
	"python.testing.pytestPath": "${workspaceFolder}/dk-server/.venv/Scripts/pytest",
	"python.testing.autoTestDiscoverOnSaveEnabled": true,
}
</code></pre>
<p>These are used by VSCode when running running the project.  The paths describe where various files or directory are that uv and pytest need to operate.  <code>${workspaceFolder}</code> is the root of the workspace, in this case that is dk_server_ws.  You will need to check these paths to make sure that they match the names of your own directories.</p>
<p><em><strong>NOTE:</strong></em>  This if the paths for windows, on linux the <code>Scripts</code> in the path might be <code>bin</code> instead.</p>
<h4 id="extensionsjson"><a class="header" href="#extensionsjson">extensions.json</a></h4>
<pre><code>{
	"recommendations": [
		"ms-python.python",
        "ms-python.vscode-pylance",
        "charliermarsh.ruff",
		"qwtel.sqlite-viewer",
	]
}
</code></pre>
<p>These are the extensions that you will want to add in order to work on the server.</p>
<h4 id="rufftoml"><a class="header" href="#rufftoml">ruff.toml</a></h4>
<pre><code>[format]
indent-style = "tab"
</code></pre>
<p>This to configure ruff to use tabs in stead of spaces for its indention.  You can add any configurations for ruff here.</p>
<h4 id="gitignore"><a class="header" href="#gitignore">.gitignore</a></h4>
<pre><code># Python-generated files
__pycache__/
*.py[oc]
build/
dist/
wheels/
*.egg-info

# Virtual environments
.venv

# Sphinx Docs builds
docs/build
*rst
!index.rst

# secrets
.env

# Database
*.sqlite


</code></pre>
<p>These are the files that we do not want git to track or upload to the repository.</p>
<h4 id="dockerignore"><a class="header" href="#dockerignore">.dockerignore</a></h4>
<pre><code># Docker Build tools
docker_run.sh
docker_run.ps1


# Python related
.venv
__pycache__
*.pyc
*.pyo
*.pyd
*.Python
env
pip-log.txt
pip-delete-this-directory.txt
.tox
.coverage
.coverage.*
.cache
.mypy_cache

# Dev related
ruff.toml
.git
.gitignore
.vscode
tests
*.cover
*.log
.pytest_cache
docs
</code></pre>
<p>These are the files that you do not want docker to build into the image.</p>
<h4 id="pyprojecttoml"><a class="header" href="#pyprojecttoml">pyproject.toml</a></h4>
<p>UV will mostly handle this file for you, but you need to add:</p>
<pre><code>[tool.pytest.ini_options]
pythonpath = "src"
</code></pre>
<p>to the file for pytest to operate.</p>
<p>Now we need to test out the project by making a "hello world" server.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fastapi-hello-world"><a class="header" href="#fastapi-hello-world">FastAPI Hello World</a></h1>
<p>To test that all these extensions are working and that the settings are properly configured we need to make our "hello world program"</p>
<h3 id="first-hello"><a class="header" href="#first-hello">First Hello</a></h3>
<p>Before we try to make the server lets just try to run any python file.</p>
<p>In <code>main.py</code> add:</p>
<pre><code>def main():
	print("Hello World")



if __name__ == "__main__":
	main()
</code></pre>
<p>and run</p>
<pre><code>uv run .\dk-server\src\dk_server\main.py
</code></pre>
<p>you might need to change the slash depending on which platform you are on, and the names in the path to match your project.  You also need to make sure that this is ran with the workspace as the working directory.</p>
<p>Hopefully you should see <code>Hello World</code> in the output.</p>
<h3 id="hello-but-server-this-time"><a class="header" href="#hello-but-server-this-time">Hello (but server this time)</a></h3>
<p>Now we need to add some dependencies to the project.</p>
<p>First we run:</p>
<pre><code>uv add --directory .\dk-server\ fastapi "uvicorn[standard]"
</code></pre>
<p>uvicorn is the server that we will be using to host our api.</p>
<p>This should add fastapi and uvicorn to our pyproject.toml file.</p>
<p>(<code>--directory \dk-erver\</code> is only needed if you are running your terminal commands from with the workspace as the working directory, I will be using that as my working directory for all further steps unless specified.)</p>
<p>We then change main.py to:</p>
<pre><code>from fastapi import FastAPI, Response

app = FastAPI()


@app.get("/")
def root():
	return Response(content="This is dk_server Root", media_type="text")

</code></pre>
<p>To test this we then run:</p>
<pre><code>uv run --directory .\dk-server\ uvicorn --app-dir .\dk-server\src\ dk_server.main:app --reload
</code></pre>
<p><code>--app-dir</code> is where the server package is located.</p>
<p><code>--reload</code> means that the server will stay running and anytime changes are made, the server will automatically reset and add those changes.</p>
<p>To test if it is working you can enter the url <code>localhost:8000</code> in to your browser and it should return "This is dk_server Root"</p>
<h3 id="hello-but-container-this-time"><a class="header" href="#hello-but-container-this-time">Hello (but container this time)</a></h3>
<p>The next thing to test to running the server from a docker image and container.</p>
<p>You will need to have docker installed. <a href="https://www.docker.com/">https://www.docker.com/</a></p>
<p>The project will also need a dockerfile.  This will be the directions that docker will use to create the container image of our api server.</p>
<p>I used this as my reference for making my dockerfile: <a href="https://github.com/astral-sh/uv-docker-example/tree/main">link</a></p>
<pre><code># Use a Python image with uv pre-installed
FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim

# Install the project into `/app`
WORKDIR /app

# Enable bytecode compilation
ENV UV_COMPILE_BYTECODE=1

# Copy from the cache instead of linking since it's a mounted volume
ENV UV_LINK_MODE=copy

# Install the project's dependencies using the lockfile and settings
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=./dk-server/uv.lock,target=uv.lock \
    --mount=type=bind,source=./dk-server/pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project --no-dev

# Then, add the rest of the project source code and install it
# Installing separately from its dependencies allows optimal layer caching
ADD ./dk-server/ /app
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

# Place executables in the environment at the front of the path
ENV PATH="/app/.venv/bin:$PATH"
# ENV UV_ENV_FILE="./.env"

# Reset the entrypoint, don't invoke `uv`
ENTRYPOINT []

# Run the FastAPI application by default
# Uses `fastapi dev` to enable hot-reloading when the `watch` sync occurs
# Uses `--host 0.0.0.0` to allow access from outside the container
CMD ["/app/.venv/bin/uvicorn", "--app-dir", "./src/dk_server", "dk_server.main:app", "--port", "8000", "--host", "0.0.0.0"]
</code></pre>
<ul>
<li>First it installs uv in the container.</li>
<li>Then sets the working directory as <code>app</code>.</li>
<li>Sets some environment variables.</li>
<li>The first run commands loads in the projects lock file, pyproject.toml, and cache and installs all the project's dependencies.</li>
<li>Then the source files are added to container</li>
<li>The bin folder is added to the environments path.</li>
<li>Finally a command is run in the container to run the server.</li>
</ul>
<p>I had to change quite a few paths in this file compared to the example one from the GitHub due to my project structure and where the dockerfile sets.</p>
<h4 id="build"><a class="header" href="#build">Build</a></h4>
<p>To build the image you can run:</p>
<pre><code>docker build -t dk-app-server .
</code></pre>
<p><code>-t</code> is the name of the image.
<code>.</code> is the location of the files, in this case the current directory.</p>
<p>I had a few issues building my image, I was able to eventually fix them by deleting the <code>.venv</code> directory.</p>
<h4 id="run"><a class="header" href="#run">Run</a></h4>
<p>To run the container you can run:</p>
<pre><code>docker run dk-app-server -p 8000:8000
</code></pre>
<p>This should start up the container, and the uvicorn server, so you can go to <code>localhost:8000</code> to see the hello world message.</p>
<h4 id="hot-reloading"><a class="header" href="#hot-reloading">Hot Reloading</a></h4>
<p>As we saw earlier you can use <code>--reload</code> when running uvicorn to automatically restart the server when changes are made to the source code.  This won't work in the container though as the code in the container is a copy of the project.</p>
<p>While developing the server we want to be able to keep the option of hot reloading.  We could just develop the server running uvicorn directly, and then occasionally testing it as a container, but this can cause issues if for some reason your project runs fine locally, but does not run in the container then you have to go through all your changes from the last time you ran the container and figure out which one broke it.</p>
<p>We want to be able to hot reload the server <em>while</em> it is in the container.  This can be done by mounting the project files into the container so that local files are used instead of the copies in the container.</p>
<p><code>run.ps1</code></p>
<pre><code>Param(
	$Command
)
If (-Not $Command -eq '') {
	docker run --rm --name devtest --mount type=bind,source=$(pwd)/dk-server,target=/app --volume /app/.venv --publish 8000:8000 -it $(docker build -q .) "$Command"
} Else {
	docker run --rm --name devtest --mount type=bind,source=$(pwd)/dk-server,target=/app --volume /app/.venv --publish 8000:8000 -it $(docker build -q .)  "./src/devscripts/start.sh"
}
</code></pre>
<p>The GitHub with the example dockerfile also has a bash script to run the image with the source files mounted.</p>
<p>I am working in windows at the moment so I had to convert it into a PowerShell script.  It works okay enough.  If you use the bash script instead, for this file structure <code>.:/app</code> will need to be changed to <code>./dk-server:/app</code>.  I also suggest changing the <code>--volume</code> to a <code>--mount</code> like in the above PowerShell script.  I was having issues with changes in the source files not appearing in the the container and finally figured out it was because I had accidently created a named volume instead.</p>
<p>Here is docker's docs on how volumes and binds work: <a href="https://docs.docker.com/engine/storage/volumes/">link</a></p>
<p>The other thing that needs to be added is the <code>start.sh</code> script.  This is just a one line bash script that runs the command with all the options set for starting the uvicorn server with reloading.</p>
<p><code>start.sh</code></p>
<pre><code>#!/usr/bin/env sh
uv run uvicorn --app-dir ./src/dk_server dk_server.main:app --port 8000 --host 0.0.0.0 --reload
</code></pre>
<p>I put this in a <code>devscripts</code> directory under the <code>src</code> directory.</p>
<p>Now you should be able to run <code>.\scripts\run.ps1</code> to start the container with the source code mounted as a bind and start uvicorn with reloading enabled.  Or you can run <code>.\scripts\run.ps1 /bin/bash</code> to start the container and start the command line in the container to test things.</p>
<h2 id="action-buttons"><a class="header" href="#action-buttons">Action Buttons</a></h2>
<p>Because we now have quite a few command that we have to run to work on or test the server I recommend setting up action buttons.  We already have the bash and PowerShell scripts to shorten it a little, but we can add a button to VSCode to run those scripts.   These settings will need to be added to you workspace save files setting section.</p>
<pre><code>// Action Buttons

	"actionButtons": {
		"defaultColor": "#ff0034", // Can also use string color names.
		"loadNpmCommands":false, // Disables automatic generation of actions for npm commands.
		"reloadButton":"♻️", // Custom reload button text or icon (default ↻). null value enables automatic reload on configuration change
		"commands": [
			{
				"cwd": "${workspaceFolder}",
				"name": "$(triangle-right) Run Container",
				"color": "green",
				"command": ".\\scripts\\run.ps1",
			},
			{
				"cwd": "${workspaceFolder}",
				"name": "$(tools) Bash Container",
				"color": "white",
				"command": ".\\scripts\\run.ps1 /bin/bash",
			},
			{
				"cwd": "${workspaceFolder}",
				"name": "$(close)Docker Close",
				"color": "red",
				"command": ".\\scripts\\clean.ps1"
			}
		]
	}
</code></pre>
<p>This will add three action buttons for us:</p>
<ul>
<li>"Run Container" This will run the PowerShell script to run the container with the source code bind and hot reloading.</li>
<li>"Bash Container" This will open up the bash shell in the container.</li>
<li>"Docker Close" This will stop the container and remove and images.</li>
</ul>
<p><code>clean.ps1</code></p>
<pre><code>docker stop devtest
docker image prune -f
</code></pre>
<p>These action button use the <code>${workSpaceFolder}</code> as the cwd.  VSCode uses the workspace of the currently active file to determine what you current workspace is.  This means that these will only work if you have on of the files for the dk_server_ws part of the project currently open.</p>
<p>Feel free to change this to a hardcoded path, or to what ever you prefer depending on how you set up your workspace.</p>
<p>Try making an action button to start up uvicorn without docker if you want.</p>
<p>Next we will set up pytest.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><p>[[Appendix]]</p>
<h3 id="setup-git-user-info"><a class="header" href="#setup-git-user-info">Setup Git User Info</a></h3>
<pre><code>git config --global user.name "NAME"
git config --global user.email "EMAIL"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h3 id="no-user-or-email-for-commit"><a class="header" href="#no-user-or-email-for-commit">No user or email for commit</a></h3>
<p>Add you name and email using:</p>
<pre><code>git config --global user.name "NAME"
git config --global user.email "EMAIL"
</code></pre>
<p>With or without the <code>--global</code> option.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="python-trouble-shooting"><a class="header" href="#python-trouble-shooting">Python Trouble Shooting</a></h1>
<h3 id="uv-sync-cant-find-module-encodings"><a class="header" href="#uv-sync-cant-find-module-encodings"><code>UV sync cant find module encodings</code></a></h3>
<p>I had this issue when creating my first docker image.  I was able to fix it by deleting the <code>.venv</code> directory and letting uv create a new one.</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="docker-trouble-shooting"><a class="header" href="#docker-trouble-shooting">Docker Trouble Shooting</a></h1>
<h3 id="bind-mount-does-not-update-in-container-when-updated-on-host"><a class="header" href="#bind-mount-does-not-update-in-container-when-updated-on-host">Bind mount does not update in container when updated on host.</a></h3>
<p>I had this issue, and it was because I was using the <code>--volume</code> command.  I so how accidently created a named volume one of the times I was running the images and so every time after that when I ran the image it mounted this named volume instead of binding the source files.  Use <code>--mount</code> to explicitly state what you want, and look for unwanted volumes with <code>docker volume ls</code></p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h2 id="start-server-with-hot-reloading"><a class="header" href="#start-server-with-hot-reloading">Start server with hot reloading:</a></h2>
<h4 id="docker-start-script"><a class="header" href="#docker-start-script">Docker start script</a></h4>
<pre><code>.\scripts\run.ps1
</code></pre>
<h4 id="docker-start-shell"><a class="header" href="#docker-start-shell">Docker start shell</a></h4>
<pre><code>.\scripts\run.ps1 /bin/bash
</code></pre>
<h4 id="uvicorn-start-command"><a class="header" href="#uvicorn-start-command">uvicorn start command</a></h4>
<pre><code>uv run uvicorn --app-dir ./src/dk_server dk_server.main:app --port 8000 --host 0.0.0.0 --reload
</code></pre>
<h3 id="docker"><a class="header" href="#docker">Docker</a></h3>
<pre><code>docker build -t &lt;IMAGE-NAME&gt; .
docker run --rm --name &lt;CONTAINER-NAME&gt; -p &lt;SOURCE-PORT&gt;:&lt;DESTINATION-PORT&gt; &lt;IMAGE-NAME&gt;
docker volumes prune
docker images prune
</code></pre>
<h4 id="example"><a class="header" href="#example">Example</a></h4>
<pre><code>docker build -t dk-app-server .
docker run --rm --name dk-app-api -p 8000:8000 dk-app-server
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
